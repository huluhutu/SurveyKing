(self.webpackChunksurvey_king=self.webpackChunksurvey_king||[]).push([[6637],{78210:function(ve,V,r){"use strict";var Y=r(27856),E=r.n(Y),O=r(15020),f=r(85893),x=function(C){var N=C.html,p=N===void 0?"":N,$=C.replaceP,Q=$===void 0?!0:$;return Q?(0,f.jsx)("div",{className:"pe-view",children:typeof p=="string"&&(0,O.ZP)(E().sanitize(p,{ADD_TAGS:["iframe"],ADD_ATTR:["allow","allowfullscreen","frameborder","scrolling"]}).replace(/<p>/,"<span>").replace(/<\/p>/,"</span>"))}):(0,f.jsx)(f.Fragment,{children:typeof p=="string"&&(0,O.ZP)(E().sanitize(p))})};V.Z=x},47488:function(ve,V,r){"use strict";r.r(V),r.d(V,{MobileOrPC:function(){return te},default:function(){return Te}});var Y=r(71194),E=r(50146),O=r(11849),f=r(39428),x=r(3182),q=r(68068),C=r(9761),N=r(62612),p=r(67294),$=r(51615),Q=r(92725),H=r(12997),Ce=r(49111),ce=r(19650),$e=r(57663),K=r(71577),fe=r(94657),L=r(3980),he=r(27400),ge=r(73727),me=r(49914),T=r(96389),i=r(85893),pe=(0,C.Pi)(function(){var S,o,e=(0,me.H)(),u=(0,he.a)(),t=e.success,l=(S=e.setting)===null||S===void 0?void 0:S.submittedSetting,c=(o=e.setting)===null||o===void 0?void 0:o.answerSetting.loginRequired,a=e.survey,v=e.id,g=(0,p.useMemo)(function(){return a?(0,T.R6)(a):{}},[a]),A=l||{},Z=A.contentHtml,w=A.redirectUrl,n=A.answerAnalysis,y=A.rankVisible,F=A.transcriptVisible,j=e.answerId,se=e.answerQrCodeUrl,M=e.answerView,m=e.values;(0,p.useEffect)(function(){if(w&&m){if(!w.includes("(")){window.location.href=w;return}var D=(0,T.vW)(w,function(P){var W=(0,T.Op)(P),B=(0,fe.Z)(W,2),J=B[0],ie=B[1],z=m[J];return(0,T.d0)(g,z,P)});D.success&&(window.location.href=D.result)}},[w,m]),(0,p.useEffect)(function(){t&&a&&m&&M&&(0,T.MA)(a,Z,m,M.examScore)},[Z,t,a,m,M]);var U=function(){var P="";return n&&y?P="\u67E5\u770B\u6392\u540D\u53CA\u89E3\u6790":y?P="\u67E5\u770B\u8003\u8BD5\u6392\u540D":n&&(P="\u67E5\u770B\u7B54\u6848\u89E3\u6790"),P?(0,i.jsx)("div",{children:(0,i.jsx)(K.Z,{onClick:function(){return window.open("/s/".concat(v,"/exam-result/").concat(j))},children:P})}):(0,i.jsx)(i.Fragment,{})};return t?(0,i.jsx)("div",{className:"survey-end animated",children:(0,i.jsx)("div",{className:"survey-end-content",children:(0,i.jsx)("h3",{className:"survey-end-title ",children:(0,i.jsxs)("div",{children:[(0,i.jsx)("div",{id:"result-message"}),U(),(0,i.jsx)("div",{children:c&&(0,i.jsxs)(ce.Z,{children:[(0,i.jsx)(ge.rU,{to:"/",children:(0,i.jsx)(K.Z,{type:"link",onClick:function(){},children:"\u8FD4\u56DE\u9996\u9875"})}),(0,i.jsx)(K.Z,{type:"link",onClick:function(){u.logout(),(0,L.on)()},children:"\u9000\u51FA\u5173\u95ED"})]})})]})})})}):(0,i.jsx)(i.Fragment,{})}),we=pe,_=r(78210),Me=r(34792),ee=r(48086),ye=r(69610),je=r(54941),s=r(54531),re=r(36855),Ie=r(42238),Se=r.n(Ie),Oe=function(){function S(o){var e;(0,ye.Z)(this,S),this.id=void 0,this.project=void 0,this.survey=void 0,this.loading=void 0,this.verifying=!1,this.saving=!1,this.isPC=void 0,this.errorCode=void 0,this.errorMessage=void 0,this.progress=0,this.confirmTempAnswerType=0,this.statistics=void 0,this.answerUrl=void 0,this.answerQrCodeUrl=void 0,this.loginRequired=void 0,this.whitelistName=void 0,this.success=void 0,this.answerId=void 0,this.answerView=void 0,this.values=void 0,this.openId=void 0,this.token=void 0,this.surveyRef=void 0,this.id=o.id,this.answerId=o.answerId,this.surveyRef=o.surveyRef;var u=re.parse(window.location.search);u&&(this.openId=u.openId,this.token=u["sk-token"]),this.makeObservable(),this.loadProject(),this.confirmTempAnswerType=(e=this.savedAnswer)!==null&&e!==void 0&&e.progress?1:0}return(0,je.Z)(S,[{key:"makeObservable",value:function(){(0,s.Ou)(this,{id:s.LO.ref,answerId:s.LO.ref,survey:s.LO.ref,loading:s.LO.ref,saving:s.LO.ref,verifying:s.LO.ref,project:s.LO.ref,errorCode:s.LO.ref,errorMessage:s.LO.ref,progress:s.LO.ref,confirmTempAnswerType:s.LO.ref,statistics:s.LO.ref,answerUrl:s.LO.ref,answerQrCodeUrl:s.LO.ref,success:s.LO.ref,answerView:s.LO.ref,values:s.LO.ref,loginRequired:s.LO.ref,whitelistName:s.LO.ref,openId:s.LO.ref,token:s.LO.ref,passwordRequired:s.LO.computed,mode:s.LO.computed,tempSaveId:s.LO.computed,status:s.LO.computed,setting:s.LO.computed,tempSave:s.aD,saveData:s.aD,loadProject:s.aD,changeProgress:s.aD,validate:s.aD})}},{key:"setting",get:function(){var e;return(e=this.project)===null||e===void 0?void 0:e.setting}},{key:"status",get:function(){var e;return(e=this.project)===null||e===void 0?void 0:e.status}},{key:"passwordRequired",get:function(){var e;return(e=this.project)===null||e===void 0?void 0:e.passwordRequired}},{key:"mode",get:function(){var e;return(e=this.project)===null||e===void 0?void 0:e.mode}},{key:"tempSaveId",get:function(){return"savedAnswer-"+this.id}},{key:"savedAnswer",get:function(){var e=localStorage.getItem(this.tempSaveId);return e&&JSON.parse(e)}},{key:"startTime",get:function(){var e,u,t;return((e=this.savedAnswer)===null||e===void 0||(u=e.metaInfo)===null||u===void 0||(t=u.answerInfo)===null||t===void 0?void 0:t.startTime)||new Date().getTime()}},{key:"tempSave",value:function(e){var u=localStorage.getItem(this.tempSaveId),t;u?(t=JSON.parse(u),t.answer=e,t.progress=this.progress):t={answer:e,metaInfo:{answerInfo:{startTime:new Date().getTime()}},progress:this.progress},localStorage.setItem(this.tempSaveId,JSON.stringify(t))}},{key:"saveData",value:function(){var o=(0,x.Z)((0,f.Z)().mark(function u(t,l){var c,a,v=this,g,A,Z,w,n,y;return(0,f.Z)().wrap(function(j){for(;;)switch(j.prev=j.next){case 0:if(this.saving=!0,g=new(Se())().getResult(),A={answer:t,projectId:this.id,metaInfo:{answerInfo:{startTime:this.startTime,endTime:new Date().getTime()},clientInfo:{browser:g.browser.name||"",browserVersion:g.browser.version||"",deviceType:g.device.type||"",platform:g.os.name||"",platformVersion:g.os.version||""}},id:l||this.answerId,whitelistName:this.whitelistName},Z=this.startTime,w=((c=this.project)===null||c===void 0||(a=c.setting.examSetting)===null||a===void 0?void 0:a.minSubmitMinutes)||0,n=Z+w*60*1e3,!(w>0&&new Date().getTime()<n)){j.next=10;break}return ee.default.error("\u672A\u5230\u4EA4\u5377\u65F6\u95F4"),this.saving=!1,j.abrupt("return");case 10:return j.next=12,L.hi.post(this.getUrlWithToken("/api/public/saveAnswer"),A);case 12:return y=j.sent,(0,s.aD)(function(){y.success&&(y.data.answerId?v.answerId=y.data.answerId:y.data.examScore!==void 0,v.answerView=y.data,v.values=t,v.success=!0,localStorage.removeItem(v.tempSaveId)),v.saving=!1}),j.abrupt("return",y);case 15:case"end":return j.stop()}},u,this)}));function e(u,t){return o.apply(this,arguments)}return e}()},{key:"loadStatistics",value:function(){var o=(0,x.Z)((0,f.Z)().mark(function u(){var t=this,l;return(0,f.Z)().wrap(function(a){for(;;)switch(a.prev=a.next){case 0:if(!this.loading){a.next=2;break}return a.abrupt("return");case 2:return this.loading=!0,a.next=5,L.hi.post(this.getUrlWithToken("/api/public/statistics"),{id:this.id});case 5:l=a.sent,(0,s.aD)(function(){l.success&&(t.statistics=l.data),t.loading=!1});case 7:case"end":return a.stop()}},u,this)}));function e(){return o.apply(this,arguments)}return e}()},{key:"loadProject",value:function(){var o=(0,x.Z)((0,f.Z)().mark(function u(){var t=this,l;return(0,f.Z)().wrap(function(a){for(;;)switch(a.prev=a.next){case 0:return this.loading=!0,a.next=3,L.hi.post(this.getUrlWithToken("/api/public/loadProject"),{id:this.id,answerId:this.answerId});case 3:l=a.sent,(0,s.aD)(function(){l.success?(t.project=l.data,t.loginRequired=l.data.loginRequired,t.survey=l.data.survey,t.values=l.data.answer,l.data.answerId&&(t.answerId=l.data.answerId)):t.errorMessage=l.message,t.errorCode=l.code,t.loading=!1});case 5:case"end":return a.stop()}},u,this)}));function e(){return o.apply(this,arguments)}return e}()},{key:"validate",value:function(){var o=(0,x.Z)((0,f.Z)().mark(function u(t){var l=this,c;return(0,f.Z)().wrap(function(v){for(;;)switch(v.prev=v.next){case 0:return this.verifying=!0,v.next=3,L.hi.post(this.getUrlWithToken("/api/public/validateProject"),{id:this.id,answer:t,answerId:this.answerId});case 3:c=v.sent,(0,s.aD)(function(){if(c.success){var g;l.project=c.data,l.loginRequired=!1,l.survey=c.data.survey,l.whitelistName=(g=t.whitelistName)===null||g===void 0?void 0:g.whitelistName}else ee.default.error(c.message);l.verifying=!1});case 5:case"end":return v.stop()}},u,this)}));function e(u){return o.apply(this,arguments)}return e}()},{key:"upload",value:function(){var o=(0,x.Z)((0,f.Z)().mark(function u(t,l){return(0,f.Z)().wrap(function(a){for(;;)switch(a.prev=a.next){case 0:return a.abrupt("return",L.hi.upload("/api/public/upload",(0,O.Z)({fileType:4,basePath:this.id},t),l));case 1:case"end":return a.stop()}},u,this)}));function e(u,t){return o.apply(this,arguments)}return e}()},{key:"changeProgress",value:function(e){this.progress=e}},{key:"getUrlWithToken",value:function(e){return re.stringifyUrl({url:e,query:{"sk-token":this.token}})}}]),S}(),te=(0,C.Pi)(function(){var S,o,e,u,t=(0,$.UO)(),l=t.id,c=t.answerId,a=(0,$.TH)(),v=a.query.preview==="1",g=a.query.pattern,A=a.query.openid,Z=(0,p.useMemo)(function(){return(0,T.SB)()},[]),w=(0,p.useRef)(null),n=(0,p.useMemo)(function(){return new Oe({surveyRef:w,id:l,answerId:c})},[w,l,c]),y=n.saving,F=n.loading,j=(S=n.setting)===null||S===void 0?void 0:S.answerSetting,se=n.loginRequired,M=n.verifying,m=j||{},U=m.autoSave,D=m.progressBar,P=m.initialValues,W=m.questionNumber,B=m.wechatOnly,J=m.onePageOneQuestion,ie=m.answerSheetVisible,z=((o=n.setting)===null||o===void 0?void 0:o.examSetting)||{},Ae=z.exerciseMode,Ze=!!((e=n.setting)!==null&&e!==void 0&&(u=e.examSetting)!==null&&u!==void 0&&u.randomSurveyWrong),Pe=n.errorMessage,G=n.savedAnswer,ae=n.confirmTempAnswerType,De=n.statistics,k=n.survey,ne=n.answerId,oe=n.mode,ue=n.success,le=(0,T.XO)(k,a);(0,p.useEffect)(function(){k&&(0,T.iq)(k,"statEnabled","quota")&&n.loadStatistics()},[k,n]);var xe=(0,p.useCallback)(function(b,I){D&&n.changeProgress(I),U&&b&&n.tempSave(b)},[D]),Re=function(){return(0,i.jsx)(H.BW,{})},de=function(I){var h,d;return(0,i.jsxs)("div",{className:"render-failure ".concat(Z?"mobile":"phone"),children:[((h=n.project)===null||h===void 0?void 0:h.name)&&(0,i.jsx)("div",{className:"title",children:(d=n.project)===null||d===void 0?void 0:d.name}),(0,i.jsxs)("div",{className:"content",children:[(0,i.jsx)("div",{children:(0,i.jsx)(H.AT,{})}),(0,i.jsx)("h2",{children:Pe||I}),(0,i.jsx)("div",{children:"\u611F\u8C22\u5173\u6CE8\uFF01"})]})]})},Le=function(){if(ue)return(0,i.jsx)(i.Fragment,{});if(F)return(0,i.jsx)(Q.Z,{});if(n.errorCode!==200)return de();if(B&&!(0,T.CL)())return de("\u53EA\u80FD\u5728\u5FAE\u4FE1\u4E2D\u6253\u5F00");if(se)return(0,i.jsx)("div",{children:Re()});if(k&&!ue&&!M)return ae===1&&U&&oe==="survey"&&!ne?(0,i.jsx)(H.oq,{}):(0,i.jsx)(q.Z,{ref:w,mode:oe,loading:y||F,progressBar:D,questionNumber:W,theme:Z?"antdMobile":"antd",schema:k,onChange:xe,onePageOneQuestion:J,answerSheetVisible:ie,exerciseMode:Ae,wrongMode:Ze,pattern:g,onInit:function(h){n.tempSave(h.values)},onDictSearch:function(){var I=(0,x.Z)((0,f.Z)().mark(function h(d){var X;return(0,f.Z)().wrap(function(R){for(;;)switch(R.prev=R.next){case 0:return R.next=2,L.hi.loadDict(d);case 2:if(X=R.sent,!X.success){R.next=5;break}return R.abrupt("return",X.data);case 5:return R.abrupt("return",[]);case 6:case"end":return R.stop()}},h)}));return function(h){return I.apply(this,arguments)}}(),initialValues:ae===3?le:(0,O.Z)((0,O.Z)((0,O.Z)((0,O.Z)({},P),U?G==null?void 0:G.answer:{}),le),n.values),statistics:De,onUpload:function(h,d){return n.upload(h,d)},footerVisible:!(v||g==="readPretty"),headerVisible:!v,isPreview:v,onSubmit:function(h){n.saveData((0,O.Z)((0,O.Z)({},h),{},{openid:A}),ne).then(function(d){!(d!=null&&d.success)&&d!==null&&d!==void 0&&d.message&&(Z?N.u_.alert({title:"\u4FDD\u5B58\u5931\u8D25",content:(0,i.jsx)(_.Z,{html:d.message})}):E.Z.error({title:"\u4FDD\u5B58\u5931\u8D25",content:(0,i.jsx)(_.Z,{html:d.message}),okText:"\u77E5\u9053\u4E86"}))})}})},be=function(){return(0,i.jsx)(we,{})},ke=function(){var I,h,d=(I=n.survey)===null||I===void 0||(h=I.attribute)===null||h===void 0?void 0:h.backgroundImage;if(d)return{backgroundImage:"url(/api/public/preview/".concat(d,")")}};return(0,i.jsx)(T.ff.Provider,{value:n,children:(0,i.jsxs)("div",{className:"survey ".concat(Z?"mobile":"pc"),style:ke(),children:[Le(),be()]})})}),Te=te}}]);
