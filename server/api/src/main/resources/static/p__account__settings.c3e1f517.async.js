(self.webpackChunksurvey_king=self.webpackChunksurvey_king||[]).push([[6527],{46502:function(V){V.exports={baseView:"baseView___3sRG3",left:"left___GavW0",right:"right___3-EXe",avatar_title:"avatar_title___13ztg",avatar:"avatar___1GisI",button_view:"button_view___o9apF",area_code:"area_code___3Tg4d",phone_number:"phone_number___1bV0u"}},41215:function(V){V.exports={main:"main___2yGev",leftMenu:"leftMenu___179-W",right:"right___2jdGg",title:"title___3cGwa"}},41794:function(V,A,t){"use strict";t.r(A),t.d(A,{default:function(){return se}});var ne=t(30887),G=t(28682),p=t(11849),D=t(94657),j=t(67294),K=t(87859),ie=t(34792),B=t(48086),ue=t(43185),R=t(32620),le=t(57663),M=t(71577),y=t(39428),I=t(3182),U=t(84391),F=t(82837),$=t(7789),Z=t(3980),S=t(27400),f=t(9761),J=t(46502),g=t.n(J),T=t(5481),z=t.n(T),e=t(85893),L=(0,f.Pi)(function(){var E=(0,S.a)(),r=E.user,o=function(){var v=(0,I.Z)((0,y.Z)().mark(function n(u){var i,d,s,l;return(0,y.Z)().wrap(function(c){for(;;)switch(c.prev=c.next){case 0:i=u.onSuccess,d=u.onError,s=u.file,l=u.onProgress,Z.hi.upload("/api/public/upload",{file:s},function(a){l&&l({percent:a.loaded/a.total*100})}).then(function(a){if(a.success&&i&&(i(a.data),Z.hi.updateUserInfo({avatar:a.data.id}).then(function(C){C.success&&(r.avatar=a.data.id)})),!a.success&&d){var x=new Error("Some error");d({event:x})}});case 2:case"end":return c.stop()}},n)}));return function(u){return v.apply(this,arguments)}}();return(0,e.jsxs)(e.Fragment,{children:[(0,e.jsx)("div",{className:g().avatar_title,children:"\u5934\u50CF"}),(0,e.jsx)("div",{className:g().avatar,children:r!=null&&r.avatar?(0,e.jsx)("img",{style:{borderRadius:"50%"},src:"/api/public/preview/".concat(r==null?void 0:r.avatar),alt:"avatar"}):(0,e.jsx)("img",{style:{borderRadius:"50%"},src:z(),alt:"avatar"})}),(0,e.jsx)($.Z,{rotate:!0,shape:"round",cropperProps:{},children:(0,e.jsx)(R.Z,{showUploadList:!1,customRequest:o,children:(0,e.jsx)("div",{className:g().button_view,children:(0,e.jsxs)(M.Z,{children:[(0,e.jsx)(U.Z,{}),"\u66F4\u6362\u5934\u50CF"]})})})})]})}),O=function(){var r=(0,S.a)(),o=r.user,v=r.loading,n=(0,j.useMemo)(function(){return o},[]),u=function(){var i=(0,I.Z)((0,y.Z)().mark(function d(s){return(0,y.Z)().wrap(function(h){for(;;)switch(h.prev=h.next){case 0:Z.hi.updateUserInfo(s).then(function(c){c.success&&(r.user=(0,p.Z)((0,p.Z)({},o),s),B.default.success("\u66F4\u65B0\u57FA\u672C\u4FE1\u606F\u6210\u529F"))});case 1:case"end":return h.stop()}},d)}));return function(s){return i.apply(this,arguments)}}();return(0,e.jsx)("div",{className:g().baseView,children:v?null:(0,e.jsxs)(e.Fragment,{children:[(0,e.jsx)("div",{className:g().left,children:(0,e.jsxs)(F.ZP,{layout:"vertical",onFinish:u,submitter:{resetButtonProps:{style:{display:"none"}},submitButtonProps:{children:"\u66F4\u65B0\u57FA\u672C\u4FE1\u606F"}},initialValues:n,hideRequiredMark:!0,children:[(0,e.jsx)(F.V,{width:"md",name:"name",label:"\u59D3\u540D",rules:[{required:!0,message:"\u8BF7\u8F93\u5165\u60A8\u7684\u6635\u79F0!"}]}),(0,e.jsx)(F.V,{name:"phone",label:"\u624B\u673A\u53F7",rules:[{required:!0,message:"\u8BF7\u8F93\u5165\u60A8\u7684\u8054\u7CFB\u7535\u8BDD!"}]}),(0,e.jsx)(F.V,{width:"md",name:"email",label:"\u90AE\u7BB1",rules:[{required:!0,message:"\u8BF7\u8F93\u5165\u60A8\u7684\u90AE\u7BB1!"}]}),(0,e.jsx)(F.$J,{name:"profile",label:"\u4E2A\u4EBA\u7B80\u4ECB",rules:[{required:!0,message:"\u8BF7\u8F93\u5165\u4E2A\u4EBA\u7B80\u4ECB!"}],placeholder:"\u4E2A\u4EBA\u7B80\u4ECB"})]})}),(0,e.jsx)("div",{className:g().right,children:(0,e.jsx)(L,{})})]})})},W=(0,f.Pi)(O),oe=t(54421),w=t(38272),ce=t(77576),X=t(12028),Y=function(){var r=function(){var n=(0,e.jsx)(X.Z,{checkedChildren:"\u5F00",unCheckedChildren:"\u5173",defaultChecked:!0});return[{title:"\u8D26\u6237\u5BC6\u7801",description:"\u5176\u4ED6\u7528\u6237\u7684\u6D88\u606F\u5C06\u4EE5\u7AD9\u5185\u4FE1\u7684\u5F62\u5F0F\u901A\u77E5",actions:[n]},{title:"\u7CFB\u7EDF\u6D88\u606F",description:"\u7CFB\u7EDF\u6D88\u606F\u5C06\u4EE5\u7AD9\u5185\u4FE1\u7684\u5F62\u5F0F\u901A\u77E5",actions:[n]},{title:"\u5F85\u529E\u4EFB\u52A1",description:"\u5F85\u529E\u4EFB\u52A1\u5C06\u4EE5\u7AD9\u5185\u4FE1\u7684\u5F62\u5F0F\u901A\u77E5",actions:[n]}]},o=r();return(0,e.jsx)(j.Fragment,{children:(0,e.jsx)(w.ZP,{itemLayout:"horizontal",dataSource:o,renderItem:function(n){return(0,e.jsx)(w.ZP.Item,{actions:n.actions,children:(0,e.jsx)(w.ZP.Item.Meta,{title:n.title,description:n.description})})}})})},H=Y,Q=function(){var r=(0,j.useState)(!1),o=(0,D.Z)(r,2),v=o[0],n=o[1],u=(0,S.a)(),i=u.user,d=(0,Z.m2)(),s=(0,j.useRef)(),l=function(){return[{title:"\u8D26\u6237\u5BC6\u7801",actions:[(0,e.jsx)("a",{onClick:function(){return n(!0)},children:"\u4FEE\u6539"},"Modify")]}]},h=l();return(0,e.jsxs)(e.Fragment,{children:[(0,e.jsx)(w.ZP,{itemLayout:"horizontal",dataSource:h,renderItem:function(a){return(0,e.jsx)(w.ZP.Item,{actions:a.actions,children:(0,e.jsx)(w.ZP.Item.Meta,{title:a.title})})}}),(0,e.jsxs)(F.Yr,{title:"\u4FEE\u6539\u5BC6\u7801",visible:v,formRef:s,width:400,modalProps:{onCancel:function(){n(!1)},okText:"\u786E\u8BA4\u4FEE\u6539",maskClosable:!1},onFinish:function(){var c=(0,I.Z)((0,y.Z)().mark(function a(x){return(0,y.Z)().wrap(function(P){for(;;)switch(P.prev=P.next){case 0:d.saveOrUpdateUser((0,p.Z)({id:i==null?void 0:i.userId},x)).then(function(b){b.success?(n(!1),B.default.success("\u5BC6\u7801\u4FEE\u6539\u6210\u529F")):B.default.error(b.message)});case 1:case"end":return P.stop()}},a)}));return function(a){return c.apply(this,arguments)}}(),children:[(0,e.jsx)(F.V.Password,{label:"\u65E7\u5BC6\u7801",name:"oldPassword",fieldProps:{size:"large"},placeholder:"\u8BF7\u8F93\u5165\u5F53\u524D\u767B\u5F55\u5BC6\u7801",rules:[{required:!0,message:"\u8BF7\u8F93\u5165\u5BC6\u7801\uFF01"}]}),(0,e.jsx)(F.V.Password,{name:"password",label:"\u65B0\u5BC6\u7801",fieldProps:{size:"large"},placeholder:"\u8BF7\u8F93\u5165\u5BC6\u7801",rules:[{required:!0,message:"\u8BF7\u8F93\u5165\u5BC6\u7801\uFF01"}]}),(0,e.jsx)(F.V.Password,{name:"confirmPassword",label:"\u786E\u8BA4\u5BC6\u7801",fieldProps:{size:"large"},placeholder:"\u8BF7\u518D\u6B21\u8F93\u5165\u5BC6\u7801",rules:[{validator:function(a,x){var C,P,b=(C=s.current)===null||C===void 0?void 0:C.getFieldValue("password");return x?b!==x&&(P="\u4E24\u6B21\u5BC6\u7801\u8F93\u5165\u4E0D\u4E00\u81F4"):P="\u8BF7\u518D\u6B21\u8F93\u5165\u5BC6\u7801",P?Promise.reject(new Error(P)):Promise.resolve()}}]})]})]})},k=(0,f.Pi)(Q),m=t(64974),q=t(64031),_=(0,f.Pi)(function(){var E=(0,S.a)(),r=E.system,o=function(){var v=(0,I.Z)((0,y.Z)().mark(function n(u){var i,d,s,l;return(0,y.Z)().wrap(function(c){for(;;)switch(c.prev=c.next){case 0:i=u.onSuccess,d=u.onError,s=u.file,l=u.onProgress,Z.hi.upload("/api/public/upload",{file:s},function(a){l&&l({percent:a.loaded/a.total*100})}).then(function(a){if(a.success&&i&&(i(a.data),Z.hi.updateSysInfo({id:r==null?void 0:r.id,avatar:a.data.id}).then(function(C){C.success&&(r.avatar=a.data.id)})),!a.success&&d){var x=new Error("Some error");d({event:x})}});case 2:case"end":return c.stop()}},n)}));return function(u){return v.apply(this,arguments)}}();return(0,e.jsxs)(e.Fragment,{children:[(0,e.jsx)("div",{className:g().avatar_title,children:"\u7CFB\u7EDF\u56FE\u6807"}),(0,e.jsx)("div",{className:g().avatar,children:r.avatar?(0,e.jsx)("img",{src:"/api/public/preview/".concat(r==null?void 0:r.avatar),alt:"avatar"}):(0,e.jsx)("img",{src:z()})}),(0,e.jsx)(R.Z,{showUploadList:!1,customRequest:o,children:(0,e.jsx)("div",{className:g().button_view,children:(0,e.jsxs)(M.Z,{children:[(0,e.jsx)(U.Z,{}),"\u66F4\u6362\u56FE\u6807"]})})})]})}),ee=function(){var r=(0,S.a)(),o=r.system,v=r.loading,n=(0,j.useMemo)(function(){return(0,q.Np)({initialValues:o})},[]),u=(0,Z.m2)(),i=u.roles;(0,j.useEffect)(function(){u.loadRoles({current:1,pageSize:1024})},[u]),(0,j.useEffect)(function(){n.setInitialValues(o)},[o,n]),(0,j.useEffect)(function(){i.length>0&&n.setFieldState("registerInfo.roles",function(s){return s.dataSource=i.map(function(l){return{label:l.name,value:l.id}})})},[i,n]);var d=function(){var s=(0,I.Z)((0,y.Z)().mark(function l(h){return(0,y.Z)().wrap(function(a){for(;;)switch(a.prev=a.next){case 0:Z.hi.updateSysInfo((0,p.Z)((0,p.Z)({},o),h)).then(function(x){x.success&&(r.system=(0,p.Z)((0,p.Z)((0,p.Z)({},o),h),{},{avatar:o.avatar}),B.default.success("\u66F4\u65B0\u57FA\u672C\u4FE1\u606F\u6210\u529F"))});case 1:case"end":return a.stop()}},l)}));return function(h){return s.apply(this,arguments)}}();return(0,e.jsx)("div",{className:g().baseView,children:v?null:(0,e.jsxs)(e.Fragment,{children:[(0,e.jsx)("div",{className:g().left,children:(0,e.jsx)(f.RV,{form:n,children:(0,e.jsxs)(m.lt,{breakpoints:[680],layout:["vertical"],labelAlign:["left","right"],children:[(0,e.jsx)(f.gN,{name:"name",title:(0,e.jsxs)("span",{children:["\u7CFB\u7EDF\u540D\u79F0(",(0,e.jsx)("a",{href:"https://surveyking.cn/docs/changelog",target:"_blank",children:"\u7248\u672C\u53F7v1.2.2"}),")"]}),decorator:[m.xJ],component:[m.II]}),(0,e.jsx)(f.gN,{name:"description",title:"\u63CF\u8FF0\u4FE1\u606F",decorator:[m.xJ],component:[m.II.TextArea]}),(0,e.jsxs)(f.Wo,{name:"registerInfo",children:[(0,e.jsx)(f.gN,{name:"registerEnabled",title:"\u5F00\u542F\u6CE8\u518C",decorator:[m.xJ],component:[m.rs]}),(0,e.jsx)(f.gN,{name:"roles",title:"\u6CE8\u518C\u7528\u6237\u53EF\u9009\u62E9\u89D2\u8272\u5217\u8868",decorator:[m.xJ],component:[m.Ph,{mode:"multiple"}],dataSource:i.map(function(s){return{label:s.name,value:s.id}}),reactions:[function(s){var l=s.query("registerInfo.registerEnabled").get("value");l?s.setDisplay("visible"):s.setDisplay("none")}]}),(0,e.jsx)(f.gN,{name:"strongPasswordEnabled",title:"\u5F00\u542F\u5F3A\u5BC6\u7801\u9A8C\u8BC1",decorator:[m.xJ],component:[m.rs],reactions:[function(s){var l=s.query("registerInfo.registerEnabled").get("value");l?s.setDisplay("visible"):s.setDisplay("none")}]})]}),(0,e.jsx)(m.d5,{children:(0,e.jsx)(m.k4,{onSubmit:d,children:"\u63D0\u4EA4"})})]})})}),(0,e.jsx)("div",{className:g().right,children:(0,e.jsx)(_,{})})]})})},ae=(0,f.Pi)(ee),te=t(41215),N=t.n(te),re=function(){var r=(0,S.a)(),o=r.isAdmin,v={base:"\u57FA\u672C\u8BBE\u7F6E",security:"\u5B89\u5168\u8BBE\u7F6E",appInfo:"\u7CFB\u7EDF\u8BBE\u7F6E"},n=(0,j.useState)({mode:"inline",selectKey:"base"}),u=(0,D.Z)(n,2),i=u[0],d=u[1],s=(0,j.useRef)(),l=function(){return Object.keys(v).filter(function(a){return!(a==="appInfo"&&!o)}).map(function(a){return{label:v[a],key:a}})},h=function(){var a=i.selectKey;switch(a){case"base":return(0,e.jsx)(W,{});case"security":return(0,e.jsx)(k,{});case"notification":return(0,e.jsx)(H,{});case"appInfo":return(0,e.jsx)(ae,{});default:return null}};return(0,e.jsx)(K.fT,{children:(0,e.jsxs)("div",{className:N().main,ref:function(a){a&&(s.current=a)},children:[(0,e.jsx)("div",{className:N().leftMenu,children:(0,e.jsx)(G.Z,{mode:i.mode,selectedKeys:[i.selectKey],onClick:function(a){var x=a.key;d((0,p.Z)((0,p.Z)({},i),{},{selectKey:x}))},items:l()})}),(0,e.jsxs)("div",{className:N().right,children:[(0,e.jsx)("div",{className:N().title,children:v[i.selectKey]}),h()]})]})})},se=(0,f.Pi)(re)},5481:function(V,A,t){V.exports=t.p+"static/logo.eaa834e3.svg"}}]);
